<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="styles.css">
		<meta charset="UTF-8">
		<title>Mood Tracker</title>
		<script src="../MoodTrackerTest/chart.js/dist/Chart.min.js"></script>
		<style>
			div, canvas{
				width: 80%;
				max-height: 20cm;
				margin: 0 auto;
			}
		</style>
	</head>
	<body>
		<ul>
			<li><a href="WordCloud.html">Word Cloud</a></li>
			<li><a href="Diary.html">Diary</a></li>
			<li><a href="Calendar.html">Calendar</a></li>
			<li><a href="MoodTracker.html">Mood Tracker</a></li>
			<li><a href="Resources.html">Resources</a></li>
			<li><a href="Help.html">Help</a></li>
			<li><a href="AboutUs.html">About Us</a></li>
			<li style="float:right"><a class="active" href="Profile.html">Profile</a></li>
		</ul>
		<p></p>
		<div>
            <canvas id="myChart"></canvas>
        </div>
        <br><br>
        <button id="addData">Add Data</button>
	    <button id="removeData">Remove Data</button>
        <button id="reload">Reload</button>
        <button id="prevWeek">Last Week</button>
        <button id="nextWeek">Next Week</button>
        <button id="viewMonth">View Month</button>
		<button id="viewWeek">View Week</button>
		<script>
          const DAYS = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
          const MONTHS = ["January", "February", "March", "April", "May", "June","July", "August", "September", "October", "November", "December"];
          var test = [Math.floor(Math.random() * 101), Math.floor(Math.random() * 101), Math.floor(Math.random() * 101), Math.floor(Math.random() * 101), Math.floor(Math.random() * 101), Math.floor(Math.random() * 101), Math.floor(Math.random() * 101)]
          var currentWeekData = [15, 48, 92, 60, 52, 78, 60]
          var currentWeek = new Date();
          currentWeek.setDate(currentWeek.getDate() - (currentWeek.getDay() + 6) % 7);

          var config = {
              type: 'line',
              data: {
                  labels: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'],
                  datasets: [{
                      label: 'Week Starting: ' + currentWeek.toDateString(),
                      data: currentWeekData,
                      fill: false,
                      backgroundColor: 'rgba(133, 207, 240)',
                      borderColor: 'rgba(133, 207, 240)',
                  }]
              },
              options: {
                  responsive: true,

                  title: {
                      display: false,
                      text: 'Chart.js Line Chart'
                  },
                  tooltips: {
                      mode: 'index',
                      intersect: false,
                  },
                  hover: {
                      mode: 'nearest',
                      intersect: true
                  },
                  scales: {
                      xAxes: [{
                          display: true,
                          scaleLabel: {
                              display: false,
                              labelString: 'Day'
                          }
                      }],
                      yAxes: [{
						  display: false,
                          ticks: {
                              max: 100,
                              min: 0,
                          }
                      }]
                  },
                  animation: {
                      duration: 2000,
                  }
              }
          };

          function getWeekValues(/*week requested*/) {
              return [Math.floor(Math.random() * 101), Math.floor(Math.random() * 101), Math.floor(Math.random() * 101), Math.floor(Math.random() * 101), Math.floor(Math.random() * 101), Math.floor(Math.random() * 101), Math.floor(Math.random() * 101)]
          }

          function getDayValue(/*requested day*/) {
              return Math.floor(Math.random() * 101)
          }

          window.onload = function() {
              var ctx = document.getElementById('myChart').getContext('2d');
              window.myLine = new Chart(ctx, config);
          };

          document.getElementById('addData').addEventListener('click', function() {
              config.data.datasets.forEach(function(dataset) {
                  if (dataset.data.length < 7){
                      dataset.data.push(Math.floor(Math.random() * 101));
                      console.log('Data added')
                  }
              })
              window.myLine.update();
          });

          document.getElementById('removeData').addEventListener('click', function() {
            config.data.datasets.forEach(function(dataset) {
                if (dataset.data.length > 0){
                	dataset.data.pop();
                    console.log('Data removed')
                  }
            })
            window.myLine.update();
          });

          document.getElementById('reload').addEventListener('click', function() {
              config.data.datasets.forEach(function(dataset) {
					var temp = dataset.data;
					dataset.data = [];
					window.myLine.update();
					for (i = 0; i < temp.length; i++) {
						dataset.data.push(temp[i])
						window.myLine.update();
                }
              })
          });

          document.getElementById('prevWeek').addEventListener('click', function() {
			config.data.datasets.splice(0, 1);
			window.myLine.update();
			
			currentWeek.setDate(currentWeek.getDate()-7);
			console.log(currentWeek)
			var newDataset = {
				label: 'Week Starting: ' + currentWeek.toDateString(),
				backgroundColor: 'rgba(133, 207, 240)',
				borderColor: 'rgba(133, 207, 240)',
				data: getWeekValues(/*pass current week*/),
				fill: false
			};
			
			console.log('success')   
			config.data.datasets.push(newDataset)
			window.myLine.update();
          });

          document.getElementById('nextWeek').addEventListener('click', function() {
			currentWeek.setDate(currentWeek.getDate()+7);
			console.log(currentWeek)

			var d = new Date();
			d.setDate(d.getDate() - (d.getDay() + 6) % 7);
			console.log(d);
			if (currentWeek > d) {
				console.log("Can't display data that hasn't happened yet")
				currentWeek.setDate(currentWeek.getDate()-7);
				console.log(currentWeek)
			}
			else {
				config.data.datasets.splice(0, 1);
				window.myLine.update();

				var newDataset = {
					label: 'Week Starting: ' + currentWeek.toDateString(),
					backgroundColor: 'rgba(133, 207, 240)',
					borderColor: 'rgba(133, 207, 240)',
					data: getWeekValues(/*pass current week*/),
					fill: false
				};
				
				console.log('success')   
				config.data.datasets.push(newDataset)
				window.myLine.update();
			}
          });

          document.getElementById('viewMonth').addEventListener('click', function() {
              
			config.data.datasets.splice(0, 1);

			var dataMonth = []

			var month = currentWeek.getMonth();
			console.log(month);

			var year = currentWeek.getFullYear();
			console.log(year);
			
			var numDays = new Date(year, month+1, 0).getDate();
			console.log(numDays);

			var DaysMonth = [];
			for (i = 1; i <= numDays; i++) {
				DaysMonth = DaysMonth.concat(i);
			}
			console.log(DaysMonth);

			for (i=0; i < 7; i++) {
				config.data.labels.pop()
			}

			for (i=0; i < DaysMonth.length; i++) {
				config.data.labels.push(DaysMonth[i])
			}

			for (i=0; i < DaysMonth.length; i++) {
				dataMonth = dataMonth.concat(getDayValue())
			}

			var newDataset = {
					label: MONTHS[month],
					labels: DaysMonth,
					backgroundColor: 'rgba(133, 207, 240)',
					borderColor: 'rgba(133, 207, 240)',
					data: dataMonth,
					fill: false
				};

			config.data.datasets.push(newDataset)
			window.myLine.update();
			console.log(DAYS);
          });

		  document.getElementById('viewWeek').addEventListener('click', function() {
			var d = new Date();
			d.setDate(d.getDate() - (d.getDay() + 6) % 7);
			currentWeek = d;
			config.data.datasets.splice(0, 1);

			console.log(config.data.labels.length);
			config.data.labels = [];
			console.log(config.data.labels.length);

			for (i=0; i < DAYS.length; i++) {
				config.data.labels.push(DAYS[i])
			}
			console.log(config.data.labels.length);
			console.log(config.data.labels);

			var newDataset = {
				label: 'Week Starting: ' + currentWeek.toDateString(),
				backgroundColor: 'rgba(133, 207, 240)',
				borderColor: 'rgba(133, 207, 240)',
				data: getWeekValues(/*pass current week*/),
				fill: false
			};
			
			console.log('success')   
			config.data.datasets.push(newDataset)
			window.myLine.update();
		  });
		</script>
	</body>
	</html>
